!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=wp,n=e.n(t),r=window.wp.element,i=window.lodash;const{getProtocol:o,isValidProtocol:s,getAuthority:l,isValidAuthority:a,getPath:d,isValidPath:c,getQueryString:u,isValidQueryString:p,getFragment:h,isValidFragment:g}=n().url,{useMemo:m,useState:k}=n().element,{__:__}=n().i18n,{withSpokenMessages:f,Popover:w}=n().components,{prependHTTP:b}=n().url,{create:v,insert:y,isCollapsed:L,applyFormat:E}=n().richText,{__experimentalLinkControl:S}=n().blockEditor,C=S,N=[{id:"opensInNewTab",title:__("Open in new tab")},{id:"relSponsored",title:__("Sponsored link")},{id:"relUgc",title:__("User generated content")},{id:"relNofollow",title:__("Nofollow")}];var T=f((function({isActive:e,activeAttributes:t,addingLink:n,value:f,onChange:S,speak:T,stopAddingLink:A}){const _=m(i.uniqueId,[n]),[F,x]=k(),U=m((()=>{const t=window.getSelection();if(!t.rangeCount)return;const r=t.getRangeAt(0);if(n&&!e)return r;let i=r.startContainer;for(i=i.nextElementSibling||i;i.nodeType!==window.Node.ELEMENT_NODE;)i=i.parentNode;return i.closest("a")}),[n,f.start,f.end]),R={url:t.url,type:t.type,id:t.id,opensInNewTab:"_blank"===t.target,relSponsored:!!t.rel&&t.rel.includes("sponsored"),relUgc:!!t.rel&&t.rel.includes("ugc"),relNofollow:!!t.rel&&t.rel.includes("nofollow"),...F};return(0,r.createElement)(w,{key:_,anchorRef:U,focusOnMount:!!n&&"firstElement",onClose:A,position:"bottom center"},(0,r.createElement)(C,{value:R,onChange:function(t){t={...F,...t};const n=(R.opensInNewTab!==t.opensInNewTab||R.relSponsored!==t.relSponsored||R.relUgc!==t.relUgc||R.relNofollow!==t.relNofollow)&&R.url===t.url,r=n&&void 0===t.url;if(x(r?t:void 0),r)return;const m=b(t.url),k=function({url:e,type:t,id:n,opensInNewWindow:r,relSponsored:i,relUgc:o,relNofollow:s}){const l={type:"core/link",attributes:{url:e}};t&&(l.attributes.type=t),n&&(l.attributes.id=n);let a=[];return r&&(l.attributes.target="_blank",a.push("noreferrer"),a.push("noopener")),i&&a.push("sponsored"),o&&a.push("ugc"),s&&a.push("nofollow"),a.length&&(l.attributes.rel=a.join(" ")),l}({url:m,type:t.type,id:void 0!==t.id&&null!==t.id?String(t.id):void 0,opensInNewWindow:t.opensInNewTab,relSponsored:t.relSponsored,relUgc:t.relUgc,relNofollow:t.relNofollow});if(L(f)&&!e){const e=t.title||m,n=E(v({text:e}),k,0,e.length);S(y(f,n))}else{const e=E(f,k);e.start=e.end,e.activeFormats=[],S(e)}n||A(),function(e){if(!e)return!1;const t=e.trim();if(!t)return!1;if(/^\S+:/.test(t)){const e=o(t);if(!s(e))return!1;if((0,i.startsWith)(e,"http")&&!/^https?:\/\/[^\/\s]/i.test(t))return!1;const n=l(t);if(!a(n))return!1;const r=d(t);if(r&&!c(r))return!1;const m=u(t);if(m&&!p(m))return!1;const k=h(t);if(k&&!g(k))return!1}return!((0,i.startsWith)(t,"#")&&!g(t))}(m)?T(__(e?"Link edited.":"Link inserted."),"assertive"):T(__("Warning: the link has been inserted but may have errors. Please test it."),"assertive")},settings:N,forceIsEditingLink:n}))}));const{__:A}=n().i18n,{Component:_}=n().element,{withSpokenMessages:F}=n().components,{getTextContent:x,applyFormat:U,removeFormat:R,slice:P,isCollapsed:I}=n().richText,{isURL:M,isEmail:O}=n().url,{RichTextToolbarButton:V,RichTextShortcut:W}=n().blockEditor,{decodeEntities:j}=n().htmlEntities,Q="core/link",q=A("Link"),B={name:Q,title:q,tagName:"a",className:null,attributes:{url:"href",type:"data-type",id:"data-id",target:"target",rel:"rel"},__unstablePasteRule(e,{html:t,plainText:n}){if(I(e))return e;const r=(t||n).replace(/<[^>]+>/g,"").trim();return M(r)?(window.console.log("Created link:\n\n",r),U(e,{type:Q,attributes:{url:j(r)}})):e},edit:F(class extends _{constructor(){super(...arguments),this.addLink=this.addLink.bind(this),this.stopAddingLink=this.stopAddingLink.bind(this),this.onRemoveFormat=this.onRemoveFormat.bind(this),this.state={addingLink:!1}}addLink(){const{value:e,onChange:t}=this.props,n=x(P(e));n&&M(n)?t(U(e,{type:Q,attributes:{url:n}})):n&&O(n)?t(U(e,{type:Q,attributes:{url:`mailto:${n}`}})):this.setState({addingLink:!0})}stopAddingLink(){this.setState({addingLink:!1}),this.props.onFocus()}onRemoveFormat(){const{value:e,onChange:t,speak:n}=this.props;t(R(e,Q)),n(A("Link removed."),"assertive")}render(){const{isActive:e,activeAttributes:t,value:n,onChange:i}=this.props;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(W,{type:"primary",character:"k",onUse:this.addLink}),(0,r.createElement)(W,{type:"primaryShift",character:"k",onUse:this.onRemoveFormat}),e&&(0,r.createElement)(V,{name:"link",icon:"editor-unlink",title:A("Unlink"),onClick:this.onRemoveFormat,isActive:e,shortcutType:"primaryShift",shortcutCharacter:"k"}),!e&&(0,r.createElement)(V,{name:"link",icon:"admin-links",title:q,onClick:this.addLink,isActive:e,shortcutType:"primary",shortcutCharacter:"k"}),(this.state.addingLink||e)&&(0,r.createElement)(T,{addingLink:this.state.addingLink,stopAddingLink:this.stopAddingLink,isActive:e,activeAttributes:t,value:n,onChange:i}))}})};if(((n()||{}).blockEditor||{}).__experimentalLinkControl){const{registerFormatType:e,unregisterFormatType:t}=n().richText;[B].forEach((({name:n,...r})=>{t(n),e(n,r)}))}else console.log("SmartCrawl: wp.blockEditor.__experimentalLinkControl not found")}();