!function(){"use strict";var t={n:function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,{a:r}),r},d:function(e,r){for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e=wp,r=t.n(e),a=class{static get(t,e="general"){Array.isArray(t)||(t=[t]);let r=window["_wds_"+e]||{};return t.forEach((t=>{r=r&&r.hasOwnProperty(t)?r[t]:""})),r}static get_bool(t,e="general"){return!!this.get(t,e)}},s=jQuery,i=t.n(s),o=_,n=t.n(o);class h{static truncate_string(t,e){return t.length>e&&(t=Array.from(t).splice(0,e-4).join("").trim()+" ..."),t}static normalize_whitespace(t){return(t=(t=t.replace(/(\r\n|\n|\r|\t)/gm," ")).replace(/[ ]+/g," ")).trim()}static remove_shortcodes(t){if(-1===(t=t||"").indexOf("["))return t;let e=this;return t.replace(/\[(\[?)([a-zA-Z0-9_-]*)(?![\w-])([^\]\/]*(?:\/(?!\])[^\]\/]*)*?)(?:(\/)\]|\](?:([^\[]*(?:\[(?!\/\2\])[^\[]*)*)\[\/\2\])?)(\]?)/g,(function(t,r,s,i,o,n,_,h,c){if(arguments.length<7)return t||"";if("["===r&&"]"===_)return t.substring(1,t.length-1);let g=a.get("omitted_shortcodes","replacement");return n&&!g.includes(s)?e.remove_shortcodes(n.trim()):""}))}static strip_html(t){let e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""}static process_string(t,e=!1){return t=h.strip_html(t),t=h.normalize_whitespace(t),e&&(t=h.truncate_string(t,e)),t}}var c=h;!function(){let t=new class{constructor(){this.authors={},this.taxonomy_terms={},this.register_api_fetch_middleware()}key(t,e){return t+(e=""+e).trim()}add_categories(t){this.add_taxonomy_terms("category",t)}get_categories(t){return this.get_taxonomy_terms("category",t)}add_tags(t){this.add_taxonomy_terms("post_tag",t),this.add_taxonomy_terms("post_tag",t,"name")}get_tags(t){return this.get_taxonomy_terms("post_tag",t)}author_key(t){return this.key("author-",t)}add_authors(t){Array.isArray(t)?t.forEach((t=>{this.add_author(t)})):t.id&&this.add_author(t)}add_author(t){let e=this.author_key(t.id);this.authors[e]=t}get_author(t){let e=this.author_key(t);return!!this.authors.hasOwnProperty(e)&&this.authors[e]}get_query_var(t,e){let r=t.substring(1).split(/[&?]/);for(let t=0;t<r.length;t++){let a=r[t].split("=");if(decodeURIComponent(a[0])===e)return decodeURIComponent(a[1])}return!1}register_api_fetch_middleware(){r().apiFetch.use(((t,e)=>{if(this.is_term_request(t)){let e=this.get_query_var(t.path,"_fields");e&&(t.path=t.path.replace(encodeURIComponent(e),encodeURIComponent(e+",description")))}let r=e(t);return r.then((e=>{this.is_category_request(t)&&this.add_categories(e),this.is_tag_request(t)&&this.add_tags(e),this.is_get_request(t,"/wp/v2/users/")&&this.add_authors(e);let r=this.get_taxonomy_slug(t);r&&this.add_taxonomy_terms(r,e)})).catch((t=>{console.log(t)})),r}))}get_taxonomy_slug(t){if(t.method&&"GET"!==t.method||!t.path)return!1;let e=this.get_taxonomies(),r=t.path.match(/\/wp\/v2\/([a-z_-]*).*/);return!(!r||r.length<2||!r[1])&&!!e.includes(r[1])&&r[1]}is_term_request(t){return this.is_category_request(t)||this.is_tag_request(t)||!!this.get_taxonomy_slug(t)}is_category_request(t){return this.is_get_request(t,"/wp/v2/categories")}is_tag_request(t){return this.is_get_request(t,"/wp/v2/tags")}is_get_request(t,e){return t&&(!t.method||"GET"===t.method)&&t.path&&t.path.includes(e)}taxonomy_key(t,e){return this.key("taxonomy-"+t+"-term-",e)}get_taxonomy_terms(t,e){let r=[];return e.forEach((e=>{let a=this.taxonomy_key(t,e);this.taxonomy_terms.hasOwnProperty(a)&&r.push(this.taxonomy_terms[a])})),r.length!==e.length?[]:r}add_taxonomy_terms(t,e,r="id"){Array.isArray(e)?e.forEach((e=>{this.add_taxonomy_term(t,e,r)})):e.id&&this.add_taxonomy_term(t,e,r)}add_taxonomy_term(t,e,r="id"){let a=this.taxonomy_key(t,e[r]);this.taxonomy_terms[a]=e}get_taxonomies(){return a.get("taxonomies","replacement")}},e=new class{constructor(t){this.cache=t,this.category_promise=null,this.tag_promise=null,this.author_promise=null,this.term_promise={}}fetch_category_data(t){return this.category_promise||(this.category_promise=new Promise(((e,a)=>{if(!t||!t.length)return void e([]);let s=this.cache.get_categories(t);if(s.length)return void e(s);let o="/wp/v2/categories?"+i().param({include:t});r().apiFetch({path:o}).then((t=>{e(t)})).catch(a)})),this.category_promise.then((()=>{this.category_promise=null}))),this.category_promise}fetch_tag_data(t){return this.tag_promise||(this.tag_promise=new Promise(((e,a)=>{if(!t||!t.length)return void e([]);let s={};if(this.ids_numeric(t))s.include=t;else{if(!this.ids_slugs(t))return void a("IDs malformed");s.slug=t}let o=this.cache.get_tags(t);if(o.length)return void e(o);let n="/wp/v2/tags?"+i().param(s);r().apiFetch({path:n}).then((t=>{e(t)})).catch(a)})),this.tag_promise.then((()=>{this.tag_promise=null}))),this.tag_promise}fetch_taxonomy_terms(t,e){return this.term_promise.hasOwnProperty(t)||(this.term_promise[t]=new Promise(((a,s)=>{if(!e||!e.length)return void a([]);let o=this.cache.get_taxonomy_terms(t,e);if(o.length)return void a(o);let n=i().param({include:e}),_="/wp/v2/"+t+"?"+n;r().apiFetch({path:_}).then((t=>{a(t)})).catch(s)})),this.term_promise[t].then((()=>{delete this.term_promise[t]}))),this.term_promise[t]}fetch_author_data(t){return this.author_promise||(this.author_promise=new Promise(((e,a)=>{if(!t)return void e(!1);let s=this.cache.get_author(t);if(s)return void e(s);let i="/wp/v2/users/"+t;r().apiFetch({path:i}).then((t=>{e(t)})).catch(a)})),this.author_promise.then((()=>{this.author_promise=null}))),this.author_promise}ids_numeric(t){return!!Array.isArray(t)&&t.reduce(((t,e)=>{let r=!isNaN(e);return t&&r}),!0)}ids_slugs(t){return!!Array.isArray(t)&&t.reduce(((t,e)=>{let r=isNaN(e);return t&&r}),!0)}}(t);window.Wds.macroReplacement=new class{constructor(t){this.fetcher=t}format_date(t,e){return r().date.dateI18n(e,t)}get_excerpt_or_trimmed_content(t){return this.get_trimmed_excerpt(t.get_excerpt(),t.get_content())}get_trimmed_excerpt(t,e){let r=t||e,s=a.get("metadesc_max_length","replacement");r=c.strip_html(r),r=c.normalize_whitespace(r);let i=r.indexOf("[");return-1!==i&&i<s&&(r=c.remove_shortcodes(r)),this.truncate_meta_description(r,s)}truncate_meta_description(t,e){return c.truncate_string(t,e)}replace_term_macros(t,e){let r={"%%id%%":e.get_id(),"%%term_title%%":e.get_title(),"%%term_description%%":e.get_description()};return"category"===e.get_taxonomy()?(r["%%category%%"]=e.get_title(),r["%%category_description%%"]=e.get_description()):"post_tag"===e.get_taxonomy()&&(r["%%tag%%"]=e.get_title(),r["%%tag_description%%"]=e.get_description()),this.do_replace(t,{},r)}replace(t,e){let r=this.fetcher,a={"%%name%%":()=>new Promise(((t,a)=>{r.fetch_author_data(e.get_author_id()).then((e=>{let r=e&&e.name?e.name:"";t({"%%name%%":r})})).catch(a)})),"%%category%%":(t,a="name",s=!1)=>new Promise(((i,o)=>{r.fetch_category_data(e.get_category_ids()).then((e=>{let r=this.get_term_macro_value(e,a,s),o={};t&&t.length&&(o[t[0]]=r),i(o)})).catch(o)})),"%%tag%%":(t,a="name",s=!1)=>new Promise(((i,o)=>{r.fetch_tag_data(e.get_tag_ids()).then((e=>{let r=this.get_term_macro_value(e,a,s),o={};t&&t.length&&(o[t[0]]=r),i(o)})).catch(o)}))};return a["%%ct_(desc_){0,1}([a-z_]*)%%"]=t=>{let s="name";3===t.length&&"desc_"===t[1]&&(s="description");let i=t[2];return"category"===i?(0,a["%%category%%"])(t,s,!0):"post_tag"===i?(0,a["%%tag%%"])(t,s,!0):new Promise(((a,o)=>{r.fetch_taxonomy_terms(i,e.get_taxonomy_terms(i)).then((e=>{let r=this.get_term_macro_value(e,s,!0),i={};t&&t.length&&(i[t[0]]=r),a(i)})).catch(o)}))},this.do_replace(t,a,{"%%id%%":e.get_id(),"%%title%%":e.get_title(),"%%excerpt%%":this.get_excerpt_or_trimmed_content(e),"%%excerpt_only%%":e.get_excerpt(),"%%modified%%":this.format_date(e.get_modified(),"Y-m-d H:i:s"),"%%date%%":this.format_date(e.get_date(),this.get_date_format()),"%%userid%%":e.get_author_id(),"%%caption%%":e.get_excerpt()})}do_replace(t,e,r){let a=[];return Object.keys(e).forEach((r=>{let s=e[r],i=[...t.matchAll(r)];i&&i.length&&i.forEach((t=>{t&&t.length&&a.push(s(t))}))})),new Promise(((e,s)=>{Promise.all(a).then((a=>{a.push(r),a.push(this.get_general_replacements());let s=a.reduce(((t,e)=>Object.assign(t,e)),{});Object.keys(s).forEach((e=>{let r=new RegExp(e,"g");t=t.replace(r,s[e])}));let i=new RegExp("%%[a-zA-Z_]*%%","g");t=t.replace(i,""),e(t)})).catch(s)}))}get_term_macro_value(t,e,r){Array.isArray(t)||(t=[]);let a=(t=n().sortBy(t,(t=>t.name))).reduce((function(t,r){return r.hasOwnProperty(e)&&t.push(r[e]),t}),[]);return r&&a.length?a[0]:a.join(", ")}get_general_replacements(){let t=a.get("time_format","replacement");return{"%%sep%%":this.get_global("sep"),"%%sitename%%":this.get_global("sitename"),"%%sitedesc%%":this.get_global("sitedesc"),"%%page%%":this.get_global("page"),"%%pagetotal%%":this.get_global("pagetotal"),"%%pagenumber%%":this.get_global("pagenumber"),"%%spell_pagenumber%%":this.get_global("spell_pagenumber"),"%%spell_pagetotal%%":this.get_global("spell_pagetotal"),"%%spell_page%%":this.get_global("spell_page"),"%%currenttime%%":this.format_date(new Date,t),"%%currentdate%%":this.format_date(new Date,this.get_date_format()),"%%currentmonth%%":this.format_date(new Date,"F"),"%%currentyear%%":this.format_date(new Date,"Y")}}get_date_format(){return a.get("date_format","replacement")}get_global(t){return a.get(["replacements",t],"replacement")}}(e)}(jQuery)}();