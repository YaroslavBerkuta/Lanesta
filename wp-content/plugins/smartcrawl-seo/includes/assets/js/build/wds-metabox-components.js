!function(){"use strict";var e={n:function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,{a:s}),s},d:function(t,s){for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=class{constructor(){this.taxonomies={}}set_id(e){return this.id=e,this}get_id(){return this.id}set_type(e){return this.type=e,this}get_type(){return this.type}set_author_id(e){return this.author_id=e,this}get_author_id(){return this.author_id}set_title(e){return this.title=e,this}get_title(){return this.title}set_content(e){return this.content=e,this}get_content(){return this.content}set_excerpt(e){return this.excerpt=e,this}get_excerpt(){return this.excerpt}set_category_ids(e){return this.set_taxonomy_terms("category",e),this}get_category_ids(){return this.get_taxonomy_terms("category")}set_tag_ids(e){return this.set_taxonomy_terms("post_tag",e),this}get_tag_ids(){return this.get_taxonomy_terms("post_tag")}set_slug(e){return this.slug=e,this}get_slug(){return this.slug}set_date(e){return this.date=e,this}get_date(){return this.date}set_modified(e){return this.modified=e,this}get_modified(){return this.modified}set_permalink(e){return this.permalink=e,this}get_permalink(){return this.permalink}set_taxonomy_terms(e,t){this.taxonomies[e]=t}get_taxonomy_terms(e){return this.taxonomies.hasOwnProperty(e)?this.taxonomies[e]:[]}},s=wp,r=e.n(s),a=_,i=e.n(a),n=jQuery,o=e.n(n),l=class{static get(e,t="general"){Array.isArray(e)||(e=[e]);let s=window["_wds_"+t]||{};return e.forEach((e=>{s=s&&s.hasOwnProperty(e)?s[e]:""})),s}static get_bool(e,t="general"){return!!this.get(e,t)}};function c(e,t,...s){if(!e)throw new TypeError(d(t,s))}function d(e,t){let s=0;return e.replace(/%[os]/gu,(()=>h(t[s++])))}function h(e){return"object"!=typeof e||null===e?String(e):Object.prototype.toString.call(e)}const u="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:void 0;let p;class g{constructor(e,t){this.code=e,this.message=t}warn(...e){var t;try{p;const s=(null!==(t=(new Error).stack)&&void 0!==t?t:"").replace(/^(?:.+?\n){2}/gu,"\n");console.warn(this.message,...e,s)}catch(e){}}}const m=new g("W01","Unable to initialize event under dispatching."),f=new g("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),y=new g("W03","Assigning any truthy value to 'returnValue' property has no effect."),v=new g("W04","Unable to preventDefault on non-cancelable events."),b=new g("W05","Unable to preventDefault inside passive event listener invocation."),w=new g("W06","An event listener wasn't added because it has been added already: %o, %o"),E=new g("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),x=new g("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o");new g("W09","Event attribute handler must be a function: %o");class P{static get NONE(){return k}static get CAPTURING_PHASE(){return R}static get AT_TARGET(){return A}static get BUBBLING_PHASE(){return O}constructor(e,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const s=null!=t?t:{};T.set(this,{type:String(e),bubbles:Boolean(s.bubbles),cancelable:Boolean(s.cancelable),composed:Boolean(s.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return I(this).type}get target(){return I(this).target}get srcElement(){return I(this).target}get currentTarget(){return I(this).currentTarget}composedPath(){const e=I(this).currentTarget;return e?[e]:[]}get NONE(){return k}get CAPTURING_PHASE(){return R}get AT_TARGET(){return A}get BUBBLING_PHASE(){return O}get eventPhase(){return I(this).dispatchFlag?2:0}stopPropagation(){I(this).stopPropagationFlag=!0}get cancelBubble(){return I(this).stopPropagationFlag}set cancelBubble(e){e?I(this).stopPropagationFlag=!0:f.warn()}stopImmediatePropagation(){const e=I(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return I(this).bubbles}get cancelable(){return I(this).cancelable}get returnValue(){return!I(this).canceledFlag}set returnValue(e){e?y.warn():D(I(this))}preventDefault(){D(I(this))}get defaultPrevented(){return I(this).canceledFlag}get composed(){return I(this).composed}get isTrusted(){return!1}get timeStamp(){return I(this).timeStamp}initEvent(e,t=!1,s=!1){const r=I(this);r.dispatchFlag?m.warn():T.set(this,{...r,type:String(e),bubbles:Boolean(t),cancelable:Boolean(s),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}}const k=0,R=1,A=2,O=3,T=new WeakMap;function I(e,t="this"){const s=T.get(e);return c(null!=s,"'%s' must be an object that Event constructor created, but got another one: %o",t,e),s}function D(e){e.inPassiveListenerFlag?b.warn():e.cancelable?e.canceledFlag=!0:v.warn()}Object.defineProperty(P,"NONE",{enumerable:!0}),Object.defineProperty(P,"CAPTURING_PHASE",{enumerable:!0}),Object.defineProperty(P,"AT_TARGET",{enumerable:!0}),Object.defineProperty(P,"BUBBLING_PHASE",{enumerable:!0});const C=Object.getOwnPropertyNames(P.prototype);for(let e=0;e<C.length;++e)"constructor"!==C[e]&&Object.defineProperty(P.prototype,C[e],{enumerable:!0});let j;void 0!==u&&void 0!==u.Event&&Object.setPrototypeOf(P.prototype,u.Event.prototype);const S={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function F(e){const t=Object.keys(S);for(let s=0;s<t.length;++s){const r=t[s],a=S[r];Object.defineProperty(e,r,{get:()=>a,configurable:!0,enumerable:!0})}}class N extends P{static wrap(e){return new(U(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),B.set(this,{original:e});const t=Object.keys(e);for(let s=0;s<t.length;++s){const r=t[s];r in this||Object.defineProperty(this,r,q(e,r))}}stopPropagation(){super.stopPropagation();const{original:e}=L(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;const{original:t}=L(this);"cancelBubble"in t&&(t.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:e}=L(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;const{original:t}=L(this);"returnValue"in t&&(t.returnValue=e)}preventDefault(){super.preventDefault();const{original:e}=L(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){const{original:e}=L(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}}const B=new WeakMap;function L(e){const t=B.get(e);return c(null!=t,"'this' is expected an Event object, but got",e),t}const W=new WeakMap;function U(e){const t=Object.getPrototypeOf(e);if(null==t)return N;let s=W.get(t);return null==s&&(s=function(e,t){class s extends e{}const r=Object.keys(t);for(let e=0;e<r.length;++e)Object.defineProperty(s.prototype,r[e],q(t,r[e]));return s}(U(t),t),W.set(t,s)),s}function q(e,t){const s=Object.getOwnPropertyDescriptor(e,t);return{get(){const e=L(this).original,s=e[t];return"function"==typeof s?s.bind(e):s},set(e){L(this).original[t]=e},configurable:s.configurable,enumerable:s.enumerable}}function M(e){return 1==(1&e.flags)}function V(e){return 2==(2&e.flags)}function G(e){return 4==(4&e.flags)}function H(e){return 8==(8&e.flags)}function $({callback:e},t,s){try{"function"==typeof e?e.call(t,s):"function"==typeof e.handleEvent&&e.handleEvent(s)}catch(e){!function(e){try{const t=e instanceof Error?e:new Error(h(e));if("function"==typeof dispatchEvent&&"function"==typeof ErrorEvent)dispatchEvent(new ErrorEvent("error",{error:t,message:t.message}));else if("undefined"!=typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)}catch(e){}}(e)}}function z({listeners:e},t,s){for(let r=0;r<e.length;++r)if(e[r].callback===t&&M(e[r])===s)return r;return-1}function Y(e,t,s){const r=z(e,t,s);return-1!==r&&Q(e,r)}function Q(e,t,s=!1){const r=e.listeners[t];return function(e){e.flags|=8}(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),e.cow&&!s?(e.cow=!1,e.listeners=e.listeners.filter(((e,s)=>s!==t)),!1):(e.listeners.splice(t,1),!0)}W.set(Object.prototype,N),void 0!==u&&void 0!==u.Event&&W.set(u.Event.prototype,N);class Z{constructor(){X.set(this,Object.create(null))}addEventListener(e,t,s){const r=K(this),{callback:a,capture:i,once:n,passive:o,signal:l,type:c}=function(e,t,s){var r;return J(t),"object"==typeof s&&null!==s?{type:String(e),callback:null!=t?t:void 0,capture:Boolean(s.capture),passive:Boolean(s.passive),once:Boolean(s.once),signal:null!==(r=s.signal)&&void 0!==r?r:void 0}:{type:String(e),callback:null!=t?t:void 0,capture:Boolean(s),passive:!1,once:!1,signal:void 0}}(e,t,s);if(null==a||(null==l?void 0:l.aborted))return;const _=function(e,t){var s;return null!==(s=e[t])&&void 0!==s?s:e[t]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}(r,c),d=z(_,a,i);-1===d?function(e,t,s,r,a,i){let n;i&&(n=Y.bind(null,e,t,s),i.addEventListener("abort",n));const o=function(e,t,s,r,a,i){return{callback:e,flags:(t?1:0)|(s?2:0)|(r?4:0),signal:a,signalListener:i}}(t,s,r,a,i,n);e.cow?(e.cow=!1,e.listeners=[...e.listeners,o]):e.listeners.push(o)}(_,a,i,o,n,l):function(e,t,s,r){w.warn(M(e)?"capture":"bubble",e.callback),V(e)!==t&&E.warn("passive"),G(e)!==s&&E.warn("once"),e.signal!==r&&E.warn("signal")}(_.listeners[d],o,n,l)}removeEventListener(e,t,s){const r=K(this),{callback:a,capture:i,type:n}=function(e,t,s){return J(t),"object"==typeof s&&null!==s?{type:String(e),callback:null!=t?t:void 0,capture:Boolean(s.capture)}:{type:String(e),callback:null!=t?t:void 0,capture:Boolean(s)}}(e,t,s),o=r[n];null!=a&&o&&Y(o,a,i)}dispatchEvent(e){const t=K(this)[String(e.type)];if(null==t)return!0;const s=e instanceof P?e:N.wrap(e),r=I(s,"event");if(r.dispatchFlag)throw a="This event has been in dispatching.",u.DOMException?new u.DOMException(a,"InvalidStateError"):(null==j&&(j=class e extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,e)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(j.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),F(j),F(j.prototype)),new j(a));var a;if(r.dispatchFlag=!0,r.target=r.currentTarget=this,!r.stopPropagationFlag){const{cow:e,listeners:a}=t;t.cow=!0;for(let i=0;i<a.length;++i){const n=a[i];if(!H(n)&&(G(n)&&Q(t,i,!e)&&(i-=1),r.inPassiveListenerFlag=V(n),$(n,this,s),r.inPassiveListenerFlag=!1,r.stopImmediatePropagationFlag))break}e||(t.cow=!1)}return r.target=null,r.currentTarget=null,r.stopImmediatePropagationFlag=!1,r.stopPropagationFlag=!1,r.dispatchFlag=!1,!r.canceledFlag}}const X=new WeakMap;function K(e,t="this"){const s=X.get(e);return c(null!=s,"'%s' must be an object that EventTarget constructor created, but got another one: %o",t,e),s}function J(e){if("function"!=typeof e&&("object"!=typeof e||null===e||"function"!=typeof e.handleEvent)){if(null!=e&&"object"!=typeof e)throw new TypeError(d(x.message,[e]));x.warn(e)}}const ee=Object.getOwnPropertyNames(Z.prototype);for(let e=0;e<ee.length;++e)"constructor"!==ee[e]&&Object.defineProperty(Z.prototype,ee[e],{enumerable:!0});void 0!==u&&void 0!==u.EventTarget&&Object.setPrototypeOf(Z.prototype,u.EventTarget.prototype);var te=class extends Z{constructor(){super(),this.init()}init(){o()(document).on("input","input#title,textarea#content,textarea#excerpt",this.get_debounced_change_callback()).on("after-autosave.smartcrawl",(()=>this.dispatch_autosave_event())),o()(window).on("load",(()=>this.hook_tinymce_change_listener()))}get_data(){let e=r().autosave.getPostData(),s=new t,a=o()("#tax-input-post_tag").val();return s.set_id(e.post_id).set_type(e.post_type).set_author_id(e.post_author).set_title(e.post_title).set_content(e.content).set_excerpt(e.excerpt).set_category_ids(e.catslist.split(",")).set_tag_ids(a?a.split(","):[]).set_slug(e.post_name).set_date(new Date).set_modified(new Date).set_permalink(l.get("post_url","metabox"))}dispatch_content_change_event(){this.dispatchEvent(new Event("content-change"))}hook_tinymce_change_listener(){let e="undefined"!=typeof tinymce&&tinymce.get("content");e&&e.on("change",this.get_debounced_change_callback())}get_debounced_change_callback(){return i().debounce((()=>this.dispatch_content_change_event()),2e3)}dispatch_autosave_event(){this.dispatchEvent(new Event("autosave"))}autosave(){o()(document).off("after-autosave.smartcrawl"),o()(document).one("heartbeat-tick.autosave",(()=>{this.dispatch_autosave_event(),o()(document).on("after-autosave.smartcrawl",(()=>this.dispatch_autosave_event()))})),this.trigger_tinymce_save(),r().autosave.server.triggerSave()}trigger_tinymce_save(){let e=(tinyMCE||{}).triggerSave;e&&e()}is_post_dirty(){return r().autosave.server.postChanged()}},se=class extends Z{constructor(){super(),this.init()}init(){this.hook_change_listener(),this.register_api_fetch_middleware()}get_data(){let e=new t,s=this.get_editor(),r=s.getEditedPostAttribute("id");return r||(r=o()("#post_ID").val()||0),e=e.set_id(r).set_type(s.getEditedPostAttribute("type")).set_author_id(s.getEditedPostAttribute("author")).set_title(s.getEditedPostAttribute("title")).set_content(s.getEditedPostAttribute("content")).set_excerpt(s.getEditedPostAttribute("excerpt")).set_slug(s.getEditedPostAttribute("slug")).set_date(new Date(s.getEditedPostAttribute("date"))).set_modified(new Date(s.getEditedPostAttribute("modified"))).set_permalink(s.getPermalink()),"post"===this.get_post_type()?e.set_category_ids(s.getEditedPostAttribute("categories")).set_tag_ids(s.getEditedPostAttribute("tags")):this.get_taxonomies().forEach((t=>{let r=s.getEditedPostAttribute(t);r&&e.set_taxonomy_terms(t,r)})),e}get_post_type(){return l.get("post_type","metabox")}get_taxonomies(){return l.get("taxonomies","metabox")}get_editor(){return r().data.select("core/editor")}dispatch_content_change_event(){this.dispatchEvent(new Event("content-change"))}dispatch_editor(){return r().data.dispatch("core/editor")}hook_change_listener(){let e=i().debounce((()=>this.dispatch_content_change_event()),2e3);r().data.subscribe((()=>{this.is_post_loaded()&&this.get_editor().isEditedPostDirty()&&!this.get_editor().isAutosavingPost()&&!this.get_editor().isSavingPost()&&e()}))}register_api_fetch_middleware(){r().apiFetch.use(((e,t)=>{let s=t(e);return s.then((()=>{(this.is_autosave_request(e)||this.is_post_save_request(e))&&this.dispatch_autosave_event()})).catch((()=>{this.dispatch_autosave_event()})),s}))}dispatch_autosave_event(){this.dispatchEvent(new Event("autosave"))}is_autosave_request(e){return e&&e.path&&e.path.includes("/autosaves")}is_post_save_request(e){let t=this.get_data(),s=t.get_id(),r=t.get_type();return e&&e.path&&"PUT"===e.method&&e.path.includes("/"+s)&&e.path.includes("/"+r)}autosave(){this.get_editor().isEditedPostAutosaveable()?this.dispatch_editor().autosave():this.dispatch_autosave_event()}is_post_loaded(){return this.get_editor().getCurrentPostId&&this.get_editor().getCurrentPostId()}is_post_dirty(){return this.is_post_loaded()&&this.get_editor().isEditedPostDirty()}};class re{static truncate_string(e,t){return e.length>t&&(e=Array.from(e).splice(0,t-4).join("").trim()+" ..."),e}static normalize_whitespace(e){return(e=(e=e.replace(/(\r\n|\n|\r|\t)/gm," ")).replace(/[ ]+/g," ")).trim()}static remove_shortcodes(e){if(-1===(e=e||"").indexOf("["))return e;let t=this;return e.replace(/\[(\[?)([a-zA-Z0-9_-]*)(?![\w-])([^\]\/]*(?:\/(?!\])[^\]\/]*)*?)(?:(\/)\]|\](?:([^\[]*(?:\[(?!\/\2\])[^\[]*)*)\[\/\2\])?)(\]?)/g,(function(e,s,r,a,i,n,o,c,_){if(arguments.length<7)return e||"";if("["===s&&"]"===o)return e.substring(1,e.length-1);let d=l.get("omitted_shortcodes","replacement");return n&&!d.includes(r)?t.remove_shortcodes(n.trim()):""}))}static strip_html(e){let t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""}static process_string(e,t=!1){return e=re.strip_html(e),e=re.normalize_whitespace(e),t&&(e=re.truncate_string(e,t)),e}}var ae=re,ie=Wds,ne=e.n(ie);class oe{static get_title(){return o()("#wds_title").val()}static get_description(){return o()("#wds_metadesc").val()}static preview_loading(e){let t=this.get_preview_el().find(".wds-preview-container"),s="wds-preview-loading";e?t.addClass(s):t.removeClass(s)}static get_preview_el(){return o()(".wds-metabox-preview")}static replace_preview_markup(e){this.get_preview_el().replaceWith(e)}static set_title_placeholder(e){o()("#wds_title").prop("placeholder",e)}static set_desc_placeholder(e){o()("#wds_metadesc").prop("placeholder",e)}}class le extends Z{constructor(e,t){super(),this.editor=e,this.macroReplacement=t,this.init()}init(){this.editor.addEventListener("autosave",(e=>this.handle_autosave_event(e))),this.editor.addEventListener("content-change",(e=>this.handle_content_change_event(e))),o()(document).on("input propertychange",".wds-meta-field",i().debounce((e=>this.handle_meta_change(e)),200)).on("input propertychange",".wds-meta-field",i().debounce((e=>this.dispatch_meta_change_deferred_event(e)),2e3)),o()(window).on("load",(()=>this.handle_page_load()))}handle_autosave_event(){this.refresh_preview(),this.refresh_placeholders()}handle_content_change_event(){this.refresh_preview(),this.refresh_placeholders()}handle_meta_change(){this.dispatch_meta_change_event(),this.refresh_preview()}handle_page_load(){this.refresh_preview(),this.refresh_placeholders()}refresh_preview(){oe.preview_loading(!0);let e=oe.get_title()||l.get("meta_title","metabox"),t=oe.get_description()||l.get("meta_desc","metabox"),s=this.editor.get_data(),r=[];r.push(this.macroReplacement.replace(e,s)),r.push(this.macroReplacement.replace(t,s)),Promise.all(r).then((e=>{oe.preview_loading(!1);let t=ne().tpl_compile(ne().template("metabox","preview")),r=l.get("title_max_length","metabox"),a=l.get("metadesc_max_length","metabox"),i=t({link:s.get_permalink(),title:le.prepare_string(e[0],r),description:le.prepare_string(e[1],a)});oe.replace_preview_markup(i)})).catch((e=>{console.log(e)}))}refresh_placeholders(){let e=this.editor.get_data();Promise.all([this.macroReplacement.replace(l.get("meta_title","metabox"),e),this.macroReplacement.replace(l.get("meta_desc","metabox"),e)]).then((e=>{oe.set_title_placeholder(le.prepare_string(e[0])),oe.set_desc_placeholder(le.prepare_string(e[1]))})).catch((e=>{console.log(e)}))}static prepare_string(e,t=!1){return ae.process_string(e,t)}dispatch_meta_change_event(){this.dispatchEvent(new Event("meta-change"))}dispatch_meta_change_deferred_event(){this.dispatchEvent(new Event("meta-change-deferred"))}post(e,t){return t=o().extend({action:e,_wds_nonce:l.get("nonce","metabox")},t),o().post(ajaxurl,t)}}var ce=le;class _e{static get_focus_keyword_el(){return o()("#wds_focus")}static get_focus_keyword(){return this.get_focus_keyword_el().val()}static get_title(){return o()("#wds_title").val()}static get_description(){return o()("#wds_metadesc").val()}static get_metabox_el(){return o()("#wds-wds-meta-box")}static get_seo_report_el(){return o()(".wds-seo-analysis",this.get_seo_analysis_el())}static get_readability_report_el(){return o()(".wds-readability-report",this.get_readability_analysis_el())}static get_postbox_fields_el(){return o()(".wds-post-box-fields")}static replace_seo_report(e){this.get_seo_report_el().replaceWith(e)}static replace_readability_report(e){this.get_readability_report_el().replaceWith(e)}static replace_post_fields(e){this.get_postbox_fields_el().replaceWith(e)}static get_refresh_button_el(){return o()(".wds-refresh-analysis",this.get_metabox_el())}static update_refresh_button(e){this.get_refresh_button_el().prop("disabled",!e)}static get_seo_error_count(){return this.get_seo_report_el().data("errors")}static get_readability_state(){return this.get_readability_report_el().data("readabilityState")}static get_seo_analysis_el(){return o()(".wds-seo-analysis-container",this.get_metabox_el())}static get_readability_analysis_el(){return o()(".wds-readability-analysis-container",this.get_metabox_el())}static block_ui(e=!1){let t=this.get_analysis_containers();e?e.addClass(e.is("button")?"sui-button-onload":"wds-item-loading"):(o()(".wds-report-inner",t).hide(),o()(".wds-analysis-working",t).show()),o()(".wds-disabled-during-request",t).prop("disabled",!0)}static unblock_ui(){let e=this.get_analysis_containers();o()(".wds-item-loading",e).removeClass("wds-item-loading"),o()(".sui-button-onload",e).removeClass("sui-button-onload"),o()(".wds-report-inner",e).show(),o()(".wds-analysis-working",e).hide(),o()(".wds-disabled-during-request",e).prop("disabled",!1)}static get_analysis_containers(){return o()(".wds-seo-analysis-container, .wds-readability-analysis-container",this.get_metabox_el())}static update_focus_field_state(e){this.get_focus_container_el().removeClass("wds-focus-keyword-loaded wds-focus-keyword-invalid").addClass(e?"wds-focus-keyword-loaded":"wds-focus-keyword-invalid")}static get_focus_container_el(){return o()(".wds-focus-keyword")}}var de=class extends Z{constructor(e,t){super(),this.editor=e,this.metaboxOnpage=t,this.init()}init(){this.editor.addEventListener("autosave",(()=>this.refresh_analysis())),o()(document).on("click",".wds-refresh-analysis",(e=>this.handle_refresh_click(e))).on("click",".wds-seo-analysis-container .wds-ignore",(e=>this.handle_ignore_click(e))).on("click",".wds-seo-analysis-container .wds-unignore",(e=>this.handle_unignore_click(e))).on("click",".wds-readability-analysis-container .wds-ignore",(e=>this.handle_ignore_click(e))).on("click",".wds-readability-analysis-container .wds-unignore",(e=>this.handle_unignore_click(e))).on("input propertychange",".wds-focus-keyword input",i().debounce((e=>this.handle_focus_keywords_change(e)),2e3)),o()(window).on("load",(()=>this.hook_meta_change_listener())).on("load",(()=>this.handle_page_load()))}refresh_analysis(){let e=_e.get_focus_keyword();return this.post("wds-analysis-get-editor-analysis",{post_id:this.editor.get_data().get_id(),is_dirty:this.editor.is_post_dirty()?1:0,wds_title:_e.get_title(),wds_description:_e.get_description(),wds_focus_keywords:e}).done((e=>{if(!(e||{}).success)return!1;let t=(e||{}).data,s=(t||{}).seo||"",r=(t||{}).readability||"",a=(t||{}).postbox_fields||"";_e.replace_seo_report(s),_e.replace_readability_report(r),_e.replace_post_fields(a);let i=_e.get_seo_error_count(),n=_e.get_readability_state();this.dispatch_seo_update_event(i),this.dispatch_readability_update_event(n)})).always((()=>{_e.unblock_ui();let t=!(!e||!e.length);_e.update_focus_field_state(t),_e.update_refresh_button(!0)}))}handle_refresh_click(e){this.prevent_default(e),this.dispatch_event("before-analysis-refresh"),_e.block_ui(),this.editor.autosave()}handle_ignore_click(e){this.prevent_default(e);let t=o()(e.target).closest("button"),s=t.attr("data-check_id");return _e.block_ui(t),this.change_ignore_status(s,!0).done((()=>this.refresh_analysis()))}handle_unignore_click(e){this.prevent_default(e);let t=o()(e.target).closest("button"),s=t.attr("data-check_id");return _e.block_ui(t),this.change_ignore_status(s,!1).done((()=>this.refresh_analysis()))}handle_focus_keywords_change(){this.dispatch_event("before-focus-keyword-update"),_e.block_ui(_e.get_focus_container_el()),this.refresh_analysis()}hook_meta_change_listener(){let e=this.metaboxOnpage;e&&e.addEventListener("meta-change-deferred",(()=>this.refresh_analysis()))}handle_page_load(){this.dispatch_event("before-analysis-refresh"),_e.block_ui(),this.refresh_analysis()}post(e,t){return t=o().extend({action:e,_wds_nonce:l.get("nonce","metabox")},t),o().post(ajaxurl,t)}change_ignore_status(e,t){this.dispatch_event("before-ignore-status-change");let s=t?"wds-analysis-ignore-check":"wds-analysis-unignore-check";return this.post(s,{post_id:this.editor.get_data().get_id(),check_id:e})}prevent_default(e){e&&e.preventDefault&&e.stopPropagation&&(e.preventDefault(),e.stopPropagation())}dispatch_event(e){this.dispatchEvent(new Event(e))}dispatch_seo_update_event(e){let t=new CustomEvent("after-seo-analysis-update",{detail:{errors:e}});this.dispatchEvent(t)}dispatch_readability_update_event(e){let t=new CustomEvent("after-readability-analysis-update",{detail:{state:e}});this.dispatchEvent(t)}};class he{constructor(e,t,s){if(!this.is_field_valid(e))return;this.$el=e,this.macroReplacementFunction=t,this.upper=s.upper||0,this.lower=s.lower||0,this.default_value=s.default_value||"";let r=.08*this.upper;this.almost_lower=this.lower+r,this.almost_upper=this.upper-r,this.init_element(e),this.init_listeners(),this.update_indicator()}init_listeners(){this.$el.on("input propertychange",_.debounce((()=>this.update_indicator()),200)).one("input propertychange",(()=>this.add_resolving_class()))}is_field_valid(e){return!e.is(this.field_selector())&&e.is("input,textarea")}init_element(e){return e.addClass(this.field_class()),o()("<div><span></span><span></span></div>").addClass(this.indicator_class()).insertAfter(e),e}get_indicator(){return this.$el.next(this.indicator_selector())}get_bar(){return this.get_indicator().find("span").first()}get_char_count_container(){return this.get_indicator().find("span").last()}reset_classes(){this.$el.removeClass("over almost-over just-right almost-under under")}remove_resolving_class(){this.$el.removeClass("resolving")}add_resolving_class(){this.$el.addClass("resolving")}update_indicator(){let e=this.$el.val();if(e=e||this.default_value,!e)return this.get_char_count_container().hide(),this.reset_classes(),void this.remove_resolving_class();this.macroReplacementFunction(e).then((e=>{e=ae.strip_html(e),e=ae.normalize_whitespace(e);let t=Array.from(e).length,s=t/((this.upper+this.lower)/2)*100;this.remove_resolving_class(),this.$el.one("input propertychange",(()=>this.add_resolving_class())),s/=2,s=s>100?100:s,this.get_bar().width(s+"%");let r=this.get_char_count_container();r.html(t+" / "+this.lower+"-"+this.upper+" "+l.get(["strings","characters"],"admin")),t?r.show():r.hide(),this.reset_classes(),t>this.upper?this.$el.addClass("over"):this.almost_upper<t&&t<=this.upper?this.$el.addClass("almost-over"):this.almost_lower<=t&&t<=this.almost_upper?this.$el.addClass("just-right"):this.lower<=t&&t<this.almost_lower?this.$el.addClass("almost-under"):this.lower>t&&this.$el.addClass("under")}))}field_class(){return"wds-optimum-length-indicator-field"}field_selector(){return"."+this.field_class()}indicator_class(){return"wds-optimum-length-indicator"}indicator_selector(){return"."+this.indicator_class()}}!function(){let e;e=l.get_bool("gutenberg_active","metabox")?new se:new te;let t=new class{constructor(){this.authors={},this.taxonomy_terms={},this.register_api_fetch_middleware()}key(e,t){return e+(t=""+t).trim()}add_categories(e){this.add_taxonomy_terms("category",e)}get_categories(e){return this.get_taxonomy_terms("category",e)}add_tags(e){this.add_taxonomy_terms("post_tag",e),this.add_taxonomy_terms("post_tag",e,"name")}get_tags(e){return this.get_taxonomy_terms("post_tag",e)}author_key(e){return this.key("author-",e)}add_authors(e){Array.isArray(e)?e.forEach((e=>{this.add_author(e)})):e.id&&this.add_author(e)}add_author(e){let t=this.author_key(e.id);this.authors[t]=e}get_author(e){let t=this.author_key(e);return!!this.authors.hasOwnProperty(t)&&this.authors[t]}get_query_var(e,t){let s=e.substring(1).split(/[&?]/);for(let e=0;e<s.length;e++){let r=s[e].split("=");if(decodeURIComponent(r[0])===t)return decodeURIComponent(r[1])}return!1}register_api_fetch_middleware(){r().apiFetch.use(((e,t)=>{if(this.is_term_request(e)){let t=this.get_query_var(e.path,"_fields");t&&(e.path=e.path.replace(encodeURIComponent(t),encodeURIComponent(t+",description")))}let s=t(e);return s.then((t=>{this.is_category_request(e)&&this.add_categories(t),this.is_tag_request(e)&&this.add_tags(t),this.is_get_request(e,"/wp/v2/users/")&&this.add_authors(t);let s=this.get_taxonomy_slug(e);s&&this.add_taxonomy_terms(s,t)})).catch((e=>{console.log(e)})),s}))}get_taxonomy_slug(e){if(e.method&&"GET"!==e.method||!e.path)return!1;let t=this.get_taxonomies(),s=e.path.match(/\/wp\/v2\/([a-z_-]*).*/);return!(!s||s.length<2||!s[1])&&!!t.includes(s[1])&&s[1]}is_term_request(e){return this.is_category_request(e)||this.is_tag_request(e)||!!this.get_taxonomy_slug(e)}is_category_request(e){return this.is_get_request(e,"/wp/v2/categories")}is_tag_request(e){return this.is_get_request(e,"/wp/v2/tags")}is_get_request(e,t){return e&&(!e.method||"GET"===e.method)&&e.path&&e.path.includes(t)}taxonomy_key(e,t){return this.key("taxonomy-"+e+"-term-",t)}get_taxonomy_terms(e,t){let s=[];return t.forEach((t=>{let r=this.taxonomy_key(e,t);this.taxonomy_terms.hasOwnProperty(r)&&s.push(this.taxonomy_terms[r])})),s.length!==t.length?[]:s}add_taxonomy_terms(e,t,s="id"){Array.isArray(t)?t.forEach((t=>{this.add_taxonomy_term(e,t,s)})):t.id&&this.add_taxonomy_term(e,t,s)}add_taxonomy_term(e,t,s="id"){let r=this.taxonomy_key(e,t[s]);this.taxonomy_terms[r]=t}get_taxonomies(){return l.get("taxonomies","replacement")}},s=new class{constructor(e){this.cache=e,this.category_promise=null,this.tag_promise=null,this.author_promise=null,this.term_promise={}}fetch_category_data(e){return this.category_promise||(this.category_promise=new Promise(((t,s)=>{if(!e||!e.length)return void t([]);let a=this.cache.get_categories(e);if(a.length)return void t(a);let i="/wp/v2/categories?"+o().param({include:e});r().apiFetch({path:i}).then((e=>{t(e)})).catch(s)})),this.category_promise.then((()=>{this.category_promise=null}))),this.category_promise}fetch_tag_data(e){return this.tag_promise||(this.tag_promise=new Promise(((t,s)=>{if(!e||!e.length)return void t([]);let a={};if(this.ids_numeric(e))a.include=e;else{if(!this.ids_slugs(e))return void s("IDs malformed");a.slug=e}let i=this.cache.get_tags(e);if(i.length)return void t(i);let n="/wp/v2/tags?"+o().param(a);r().apiFetch({path:n}).then((e=>{t(e)})).catch(s)})),this.tag_promise.then((()=>{this.tag_promise=null}))),this.tag_promise}fetch_taxonomy_terms(e,t){return this.term_promise.hasOwnProperty(e)||(this.term_promise[e]=new Promise(((s,a)=>{if(!t||!t.length)return void s([]);let i=this.cache.get_taxonomy_terms(e,t);if(i.length)return void s(i);let n=o().param({include:t}),l="/wp/v2/"+e+"?"+n;r().apiFetch({path:l}).then((e=>{s(e)})).catch(a)})),this.term_promise[e].then((()=>{delete this.term_promise[e]}))),this.term_promise[e]}fetch_author_data(e){return this.author_promise||(this.author_promise=new Promise(((t,s)=>{if(!e)return void t(!1);let a=this.cache.get_author(e);if(a)return void t(a);let i="/wp/v2/users/"+e;r().apiFetch({path:i}).then((e=>{t(e)})).catch(s)})),this.author_promise.then((()=>{this.author_promise=null}))),this.author_promise}ids_numeric(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>{let s=!isNaN(t);return e&&s}),!0)}ids_slugs(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>{let s=isNaN(t);return e&&s}),!0)}}(t),a=new class{constructor(e){this.fetcher=e}format_date(e,t){return r().date.dateI18n(t,e)}get_excerpt_or_trimmed_content(e){return this.get_trimmed_excerpt(e.get_excerpt(),e.get_content())}get_trimmed_excerpt(e,t){let s=e||t,r=l.get("metadesc_max_length","replacement");s=ae.strip_html(s),s=ae.normalize_whitespace(s);let a=s.indexOf("[");return-1!==a&&a<r&&(s=ae.remove_shortcodes(s)),this.truncate_meta_description(s,r)}truncate_meta_description(e,t){return ae.truncate_string(e,t)}replace_term_macros(e,t){let s={"%%id%%":t.get_id(),"%%term_title%%":t.get_title(),"%%term_description%%":t.get_description()};return"category"===t.get_taxonomy()?(s["%%category%%"]=t.get_title(),s["%%category_description%%"]=t.get_description()):"post_tag"===t.get_taxonomy()&&(s["%%tag%%"]=t.get_title(),s["%%tag_description%%"]=t.get_description()),this.do_replace(e,{},s)}replace(e,t){let s=this.fetcher,r={"%%name%%":()=>new Promise(((e,r)=>{s.fetch_author_data(t.get_author_id()).then((t=>{let s=t&&t.name?t.name:"";e({"%%name%%":s})})).catch(r)})),"%%category%%":(e,r="name",a=!1)=>new Promise(((i,n)=>{s.fetch_category_data(t.get_category_ids()).then((t=>{let s=this.get_term_macro_value(t,r,a),n={};e&&e.length&&(n[e[0]]=s),i(n)})).catch(n)})),"%%tag%%":(e,r="name",a=!1)=>new Promise(((i,n)=>{s.fetch_tag_data(t.get_tag_ids()).then((t=>{let s=this.get_term_macro_value(t,r,a),n={};e&&e.length&&(n[e[0]]=s),i(n)})).catch(n)}))};return r["%%ct_(desc_){0,1}([a-z_]*)%%"]=e=>{let a="name";3===e.length&&"desc_"===e[1]&&(a="description");let i=e[2];return"category"===i?(0,r["%%category%%"])(e,a,!0):"post_tag"===i?(0,r["%%tag%%"])(e,a,!0):new Promise(((r,n)=>{s.fetch_taxonomy_terms(i,t.get_taxonomy_terms(i)).then((t=>{let s=this.get_term_macro_value(t,a,!0),i={};e&&e.length&&(i[e[0]]=s),r(i)})).catch(n)}))},this.do_replace(e,r,{"%%id%%":t.get_id(),"%%title%%":t.get_title(),"%%excerpt%%":this.get_excerpt_or_trimmed_content(t),"%%excerpt_only%%":t.get_excerpt(),"%%modified%%":this.format_date(t.get_modified(),"Y-m-d H:i:s"),"%%date%%":this.format_date(t.get_date(),this.get_date_format()),"%%userid%%":t.get_author_id(),"%%caption%%":t.get_excerpt()})}do_replace(e,t,s){let r=[];return Object.keys(t).forEach((s=>{let a=t[s],i=[...e.matchAll(s)];i&&i.length&&i.forEach((e=>{e&&e.length&&r.push(a(e))}))})),new Promise(((t,a)=>{Promise.all(r).then((r=>{r.push(s),r.push(this.get_general_replacements());let a=r.reduce(((e,t)=>Object.assign(e,t)),{});Object.keys(a).forEach((t=>{let s=new RegExp(t,"g");e=e.replace(s,a[t])}));let i=new RegExp("%%[a-zA-Z_]*%%","g");e=e.replace(i,""),t(e)})).catch(a)}))}get_term_macro_value(e,t,s){Array.isArray(e)||(e=[]);let r=(e=i().sortBy(e,(e=>e.name))).reduce((function(e,s){return s.hasOwnProperty(t)&&e.push(s[t]),e}),[]);return s&&r.length?r[0]:r.join(", ")}get_general_replacements(){let e=l.get("time_format","replacement");return{"%%sep%%":this.get_global("sep"),"%%sitename%%":this.get_global("sitename"),"%%sitedesc%%":this.get_global("sitedesc"),"%%page%%":this.get_global("page"),"%%pagetotal%%":this.get_global("pagetotal"),"%%pagenumber%%":this.get_global("pagenumber"),"%%spell_pagenumber%%":this.get_global("spell_pagenumber"),"%%spell_pagetotal%%":this.get_global("spell_pagetotal"),"%%spell_page%%":this.get_global("spell_page"),"%%currenttime%%":this.format_date(new Date,e),"%%currentdate%%":this.format_date(new Date,this.get_date_format()),"%%currentmonth%%":this.format_date(new Date,"F"),"%%currentyear%%":this.format_date(new Date,"Y")}}get_date_format(){return l.get("date_format","replacement")}get_global(e){return l.get(["replacements",e],"replacement")}}(s),n=!1;l.get_bool("onpage_active","metabox")&&(n=new ce(e,a));let c=!1;l.get_bool("analysis_active","metabox")&&(c=new de(e,n)),window.Wds=window.Wds||{},window.Wds.postEditor=e,window.Wds.metaboxAnalysis=c,window.Wds.metaboxOnpage=n,window.Wds.stringUtils=ae,window.Wds.OptimumLengthIndicator=he}(jQuery)}();